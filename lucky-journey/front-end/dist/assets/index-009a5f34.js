import{G as ee,r as g,k as te,n as le,o as Y,H as me,a as l,b as v,z as O,f as e,w as t,c as V,q as X,g as s,i as G,e as j,t as x,v as oe,I as fe,F as A,A as K,J as ge,l as Ve,K as be,_ as we,L as xe}from"./index-0c93d47c.js";const he=i=>{if(i)return i=Object.assign({},i),i.labelNames=i.labelNames.join(","),i.auditStatus=0,ee.post("/video",i)},ke=i=>ee.delete(`/video/${i}`),ne={__name:"edit",props:{currentVideo:{type:Object,default:{}},clear:{type:Function,default:()=>{}},save:{type:Function,default:()=>{}}},setup(i){const n=g(),h=g(-1),b=g([]),{currentVideo:_,save:d,clear:w}=i,m=g({show:!1,text:""}),$=()=>{w()},N=()=>{n.value.files[0]&&oe(n.value.files[0],{next:c=>{h.value=c.total.percent},error:()=>{h.value=-1,m.value={text:"上传失败",show:!0,color:"error"}},complete:(c,o)=>{if(!o.state){m.value={text:o.message,show:!0};return}h.value=-1,_.cover=o.data,m.value={text:"上传完成",show:!0,color:"success"},n.value.value=null}})},F=te(()=>{if(!_)return"/logo.png";if(n.value&&n.value.files&&n.value.files[0]){var c=window.URL||window.webkitURL;return c.createObjectURL(n.value.files[0])}return _.cover==null||_.cover==""?"/logo.png":le(_.cover)});Y(()=>{me().then(({data:c})=>{if(!c.state){b.value=[];return}b.value=c.data})});const k=()=>{he(_).then(({data:c})=>{d(c)})};return(c,o)=>{const y=l("v-text-field"),a=l("v-textarea"),p=l("v-img"),q=l("v-icon"),R=l("v-progress-circular"),z=l("v-overlay"),E=l("v-card"),C=l("v-hover"),T=l("v-chip"),I=l("v-list-item"),D=l("v-autocomplete"),M=l("v-combobox"),P=l("v-divider"),S=l("v-btn"),Q=l("v-spacer"),H=l("v-card-actions"),J=l("v-snackbar");return v(),O("div",null,[e(y,{variant:"filled",label:"视频标题",modelValue:i.currentVideo.title,"onUpdate:modelValue":o[0]||(o[0]=r=>i.currentVideo.title=r),clearable:""},null,8,["modelValue"]),e(a,{variant:"filled",label:"视频描述",rows:3,modelValue:i.currentVideo.description,"onUpdate:modelValue":o[1]||(o[1]=r=>i.currentVideo.description=r),clearable:""},null,8,["modelValue"]),e(C,null,{default:t(({isHovering:r,props:f})=>[i.currentVideo.id?G("",!0):(v(),V(E,X({key:0},f,{class:"mb-2 mx-auto",height:"150px",width:"150px",rounded:10,onClick:o[2]||(o[2]=B=>n.value.click())}),{default:t(()=>[s(" 视频封面: "),(v(),V(p,{key:i.currentVideo.cover,rounded:10,src:F.value},null,8,["src"])),e(z,{"model-value":r==!0||h.value>-1,contained:"",scrim:"black",class:"align-center justify-center"},{default:t(()=>[h.value==-1?(v(),V(q,{key:0},{default:t(()=>[s("mdi-upload")]),_:1})):(v(),V(R,{key:1,"model-value":h.value},null,8,["model-value"]))]),_:2},1032,["model-value"])]),_:2},1040))]),_:1}),j("input",{hidden:"",onChange:N,ref_key:"avatarFileRef",ref:n,type:"file",accept:"image/*"},null,544),e(D,{modelValue:i.currentVideo.typeId,"onUpdate:modelValue":o[3]||(o[3]=r=>i.currentVideo.typeId=r),items:b.value,chips:"","closable-chips":"",color:"blue-grey-lighten-2","item-title":"name","item-value":"id",label:"视频分类","no-data-text":"无视频分类"},{chip:t(({props:r,item:f})=>[e(T,X(r,{"prepend-icon":f.raw.icon||"mdi-file-document-alert-outline",text:f.raw.name}),null,16,["prepend-icon","text"])]),item:t(({props:r,item:f})=>{var B,u,L;return[e(I,X(r,{"prepend-icon":((B=f==null?void 0:f.raw)==null?void 0:B.icon)||"mdi-file-document-alert-outline",title:(u=f==null?void 0:f.raw)==null?void 0:u.name,subtitle:((L=f==null?void 0:f.raw)==null?void 0:L.description)||"无相关描述信息"}),null,16,["prepend-icon","title","subtitle"])]}),_:1},8,["modelValue","items"]),e(M,{modelValue:i.currentVideo.labelNames,"onUpdate:modelValue":o[4]||(o[4]=r=>i.currentVideo.labelNames=r),label:"视频标签",multiple:"",chips:"","closable-chips":""},null,8,["modelValue"]),e(P),e(H,null,{default:t(()=>[e(S,{color:"warning",class:"font-weight-bold",variant:"tonal",onClick:o[5]||(o[5]=r=>$())},{default:t(()=>[s("取消")]),_:1}),e(Q),e(S,{color:"success",class:"font-weight-bold",variant:"tonal",onClick:o[6]||(o[6]=r=>k())},{default:t(()=>[s(" 发布视频 ")]),_:1})]),_:1}),e(J,{modelValue:m.value.show,"onUpdate:modelValue":o[8]||(o[8]=r=>m.value.show=r),color:m.value.color},{actions:t(()=>[e(S,{color:"blue",variant:"text",onClick:o[7]||(o[7]=r=>m.value.show=!1)},{default:t(()=>[s(" 了解 ")]),_:1})]),default:t(()=>[s(x(m.value.text)+" ",1)]),_:1},8,["modelValue","color"])])}}},ye={style:{display:"none"}},Ce=["textContent"],Ue={__name:"upVideo",setup(i){const n=g({show:!1,text:""}),h=g([{image:"https://cdn.vuetifyjs.com/docs/images/chips/globe.png",title:"视频格式支持：mp4、avi、aav、cawd",category:"视频"},{image:"https://cdn.vuetifyjs.com/docs/images/chips/cpu.png",title:"发布视频后会进行视频审核。(七牛云服务自动审核)",category:"审核"},{image:"https://cdn.vuetifyjs.com/docs/images/chips/rocket.png",title:"您的视频将会被存储在七牛云的对象存储服务中。",category:"存储"}]),b=g(null),_=g(),d=g([]),w=g("快速"),m=te(()=>b.value>-1?d.value[b.value]:null);Y(()=>{$()});const $=()=>{fe().then(({data:c})=>{c.state&&(w.value=c.message)})},N=()=>{m.value.status<1&&m.value.subscription.unsubscribe(),d.value.splice(b.value,1)},F=c=>{n.value={text:c.message,show:!0},c.state&&(N(),$())},k=async()=>{if(!_.value.files[0])return;let c=_.value.files[0];const o={progress:0,status:0,msg:"",result:"",title:c.name,description:"",url:"",cover:"",file:c,labelNames:[]};d.value.push(o),d.value.length==1&&(b.value=0),o.subscription=await oe(c,{next:y=>{o.progress=y.total.percent,d.value=Object.assign([],d.value)},error:y=>{o.status=-1,o.msg="上传失败："+y,d.value=Object.assign([],d.value)},complete:(y,a)=>{if(!a.state){n.value={text:a.message,show:!0};return}o.result=y,o.status=1,o.url=a.data,o.cover=null,d.value=Object.assign([],d.value)}}),_.value.value=""};return(c,o)=>{const y=l("VIcon"),a=l("VListItem"),p=l("VCardSubtitle"),q=l("VBtn"),R=l("v-icon"),z=l("v-chip"),E=l("VList"),C=l("VCard"),T=l("VCol"),I=l("VListItemTitle"),D=l("v-img"),M=l("v-avatar"),P=l("v-list-item-title"),S=l("v-list-item"),Q=l("v-list"),H=l("VRow"),J=l("VCardTitle"),r=l("VDivider"),f=l("v-card-title"),B=l("v-progress-linear"),u=l("VCardText"),L=l("v-scroll-y-transition"),Z=l("v-card"),ae=l("v-item"),se=l("v-col"),ue=l("v-row"),ce=l("v-container"),re=l("v-item-group"),ie=l("v-card-text"),de=l("v-btn"),ve=l("v-snackbar");return v(),V(Z,null,{default:t(()=>[e(C,null,{default:t(()=>[e(H,null,{default:t(()=>[e(T,{cols:"6"},{default:t(()=>[e(C,{border:"dashed","min-height":"'300px'",class:"ma-4",variant:"outlined",style:{"text-align":"center"}},{default:t(()=>[e(E,{density:"compact",style:{margin:"0 auto"}},{default:t(()=>[e(a,null,{default:t(()=>[e(y,{color:"blue",size:50},{default:t(()=>[s("mdi-upload")]),_:1})]),_:1}),e(a,null,{default:t(()=>[e(p,null,{default:t(()=>[s("拖到此处可上传")]),_:1})]),_:1}),e(a,null,{default:t(()=>[e(q,{color:"primary",onClick:o[0]||(o[0]=U=>_.value.click())},{default:t(()=>[s("上传视频")]),_:1})]),_:1}),e(a,null,{default:t(()=>[e(z,{class:"ma-2 font-weight-bold",color:"green",label:""},{default:t(()=>[e(R,{start:"",icon:"mdi-file-cloud-outline"}),s(" 审核队列: "+x(w.value),1)]),_:1})]),_:1})]),_:1}),j("div",ye,[j("form",null,[j("input",{onChange:k,ref_key:"videoFileRef",ref:_,type:"file",accept:"video/*"},null,544)])])]),_:1})]),_:1}),e(T,{cols:"6"},{default:t(()=>[e(Q,{density:"compact",lines:"three",class:"mt-2"},{default:t(()=>[e(I,null,{default:t(()=>[e(y,null,{default:t(()=>[s("mdi-menu-down")]),_:1}),s("用户须知 ")]),_:1}),(v(!0),O(A,null,K(h.value,(U,W)=>(v(),V(S,{key:W,link:""},{prepend:t(()=>[e(M,{class:"me-4 mt-2",rounded:"0"},{default:t(()=>[e(D,{src:U.image,cover:""},null,8,["src"])]),_:2},1024)]),default:t(()=>[e(P,{class:"text-uppercase font-weight-regular text-caption",textContent:x(U.category)},null,8,["textContent"]),j("div",{textContent:x(U.title)},null,8,Ce)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),d.value.length>0?(v(),V(C,{key:0},{default:t(()=>[e(re,{mandatory:""},{default:t(()=>[e(J,null,{default:t(()=>[s("基本信息")]),_:1}),e(r),e(ce,null,{default:t(()=>[e(ue,null,{default:t(()=>[(v(!0),O(A,null,K(d.value,(U,W)=>(v(),V(se,{key:W,cols:"12",md:"3"},{default:t(()=>[e(ae,null,{default:t(({isSelected:_e,toggle:pe})=>[e(Z,{color:_e?"primary":"white",dark:"",height:"100",onClick:()=>{pe(),b.value=W}},{default:t(()=>[e(L,null,{default:t(()=>[j("div",null,[e(f,null,{default:t(()=>[s(x(U.title),1)]),_:2},1024),e(u,{class:"pb-0"},{default:t(()=>[e(B,{color:"orange",striped:"","model-value":U.progress,height:"25"},{default:t(()=>[j("strong",null,x(Math.ceil(U.progress))+"%",1)]),_:2},1032,["model-value"])]),_:2},1024)])]),_:2},1024)]),_:2},1032,["color","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),m.value?(v(),V(ie,{key:0},{default:t(()=>[e(ne,{"current-video":m.value,clear:N,save:F},null,8,["current-video"])]),_:1})):G("",!0)]),_:1})):G("",!0),e(ve,{modelValue:n.value.show,"onUpdate:modelValue":o[2]||(o[2]=U=>n.value.show=U),color:n.value.color},{actions:t(()=>[e(de,{color:"blue",variant:"text",onClick:o[1]||(o[1]=U=>n.value.show=!1)},{default:t(()=>[s(" 了解 ")]),_:1})]),default:t(()=>[s(x(n.value.text)+" ",1)]),_:1},8,["modelValue","color"])]),_:1})}}},$e=["textContent"],Le=j("div",{class:"mt-2 mb-2"},null,-1),je={__name:"videoList",setup(i){const n=g({page:1,pages:0}),h=g([]),b=g(!1),_=g(!1),d=g({}),w=g({show:!1,text:""}),m=()=>{xe(n.value.page).then(({data:a})=>{a.state&&(h.value=a.data.records,n.value.pages=a.data.pages)})};ge(()=>{m()}),Y(()=>{m()});const $=a=>{let p=Object.assign({},a);p.labelNames=p.labelNames.split(","),d.value=p,_.value=!!a},N=()=>{ke(d.value.id).then(({data:a})=>{w.value={text:a.message,show:!0,color:a.state?"success":"error"},b.value=!1,d.value={},a.state&&m()})},F=a=>{w.value={text:a.message,show:!0},a.state&&(k(),m())},k=()=>{d.value={},_.value=!1},c=g(null),o=g(!1),y=a=>{o.value=!1,c.value=a,o.value=!!a};return Ve(()=>n.value.page,()=>{m()},{immediate:!0}),(a,p)=>{const q=l("v-img"),R=l("v-chip"),z=l("v-list-item-title"),E=l("v-chip-group"),C=l("v-btn"),T=l("v-btn-group"),I=l("v-list-item"),D=l("v-divider"),M=l("v-list"),P=l("v-pagination"),S=l("v-card-title"),Q=l("v-card-text"),H=l("v-spacer"),J=l("v-card-actions"),r=l("v-card"),f=l("v-dialog"),B=l("v-snackbar");return v(),V(r,{elevation:"0"},{default:t(()=>[e(M,{lines:"three",class:"mr-2 ml-2"},{default:t(()=>[(v(!0),O(A,null,K(h.value,u=>(v(),O(A,null,[e(I,{class:"pa-0","max-height":"110px",style:{overflow:"hidden"}},{prepend:t(()=>[e(q,{width:"200",height:"100",class:"mr-4",src:be(le)(u.cover),cover:"",onClick:L=>y(u)},null,8,["src","onClick"]),u.auditStatus==2?(v(),V(R,{key:0,class:"ma-2",color:"warning",variant:"flat"},{default:t(()=>[s(x(u.msg),1)]),_:2},1024)):u.auditStatus>0?(v(),V(R,{key:1,style:{position:"absolute",left:"0",top:"0"},class:"ma-2",color:"warning",variant:"flat"},{default:t(()=>[s("审核中")]),_:1})):G("",!0)]),append:t(()=>[e(T,{variant:"outlined"},{default:t(()=>[e(C,{color:"blue",onClick:L=>$(u)},{default:t(()=>[s("编辑")]),_:2},1032,["onClick"]),e(C,{color:"red",onClick:L=>{d.value=u,b.value=!0}},{default:t(()=>[s("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[e(z,{class:"font-weight-bold",textContent:x(u.title)},null,8,["textContent"]),j("div",{textContent:x(u.description),style:{"line-height":"25px",overflow:"hidden"}},null,8,$e),e(E,null,{default:t(()=>[(v(!0),O(A,null,K(u.labelNames.split(","),L=>(v(),V(R,null,{default:t(()=>[s(x(L),1)]),_:2},1024))),256))]),_:2},1024)]),_:2},1024),e(D,{class:"ma-2"}),Le],64))),256))]),_:1}),n.value.pages>1?(v(),V(P,{key:0,modelValue:n.value.page,"onUpdate:modelValue":p[0]||(p[0]=u=>n.value.page=u),length:n.value.pages},null,8,["modelValue","length"])):G("",!0),e(f,{modelValue:b.value,"onUpdate:modelValue":p[3]||(p[3]=u=>b.value=u),persistent:"",width:"auto"},{default:t(()=>[e(r,null,{default:t(()=>[e(S,{class:"text-h5"},{default:t(()=>[s(" 确定要删除该视频？ ")]),_:1}),e(Q,null,{default:t(()=>[s("视频名 "+x(d.value.title)+".",1)]),_:1}),e(J,null,{default:t(()=>[e(H),e(C,{color:"green-darken-1",variant:"text",onClick:p[1]||(p[1]=u=>N())},{default:t(()=>[s(" 确定 ")]),_:1}),e(C,{color:"green-darken-1",variant:"text",onClick:p[2]||(p[2]=u=>b.value=!1)},{default:t(()=>[s(" 不确定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(B,{modelValue:w.value.show,"onUpdate:modelValue":p[5]||(p[5]=u=>w.value.show=u),color:w.value.color},{actions:t(()=>[e(C,{color:"blue",variant:"text",onClick:p[4]||(p[4]=u=>w.value.show=!1)},{default:t(()=>[s(" 了解 ")]),_:1})]),default:t(()=>[s(x(w.value.text)+" ",1)]),_:1},8,["modelValue","color"]),e(f,{"model-value":o.value,fullscreen:"",transition:"dialog-bottom-transition"},{default:t(()=>[c.value?(v(),V(r,{key:0},{default:t(()=>[e(we,{"video-info":c.value,"close-video":()=>y(null)},null,8,["video-info","close-video"])]),_:1})):G("",!0)]),_:1},8,["model-value"]),e(f,{modelValue:_.value,"onUpdate:modelValue":p[6]||(p[6]=u=>_.value=u),"max-width":"500"},{default:t(()=>[e(r,{class:"",title:"信息编辑"},{default:t(()=>[e(D),e(ne,{"current-video":d.value,class:"ma-4",clear:k,save:F},null,8,["current-video"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},Fe={__name:"index",setup(i){const n=g(0),h=g(["上传稿件","稿件管理"]);return(b,_)=>{const d=l("v-tab"),w=l("v-tabs"),m=l("v-divider"),$=l("v-window-item"),N=l("v-window"),F=l("v-card");return v(),V(F,null,{default:t(()=>[e(w,{modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=k=>n.value=k),color:"#7bbfea"},{default:t(()=>[(v(!0),O(A,null,K(h.value,k=>(v(),V(d,{key:k},{default:t(()=>[s(x(k),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(m),e(N,{modelValue:n.value,"onUpdate:modelValue":_[1]||(_[1]=k=>n.value=k)},{default:t(()=>[e($,{value:"0"},{default:t(()=>[e(Ue)]),_:1}),e($,{value:"1"},{default:t(()=>[e(je)]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Fe as default};
